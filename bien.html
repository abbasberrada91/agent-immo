<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D√©tail du bien - Henri Martin Immobilier</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="drawer.css" />
    <style>
      .detail-header {
        background: var(--white);
        border-bottom: 1px solid var(--line);
        padding: 1.2rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .detail-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        color: var(--brand);
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        border: 1px solid var(--line);
        transition: all 0.2s;
      }

      .back-btn:hover {
        background: var(--bg);
        border-color: var(--brand);
      }

      .detail-container {
        padding: 2rem 0;
      }

      .property-header {
        margin-bottom: 2rem;
      }

      .property-badge-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .property-title {
        font-size: 2rem;
        margin: 0 0 0.5rem;
        font-weight: 700;
      }

      .property-location {
        color: var(--muted);
        font-size: 1.1rem;
        margin: 0;
      }

      .photo-gallery {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 0.5rem;
        margin-bottom: 2rem;
        border-radius: 1rem;
        overflow: hidden;
      }

      .main-photo {
        position: relative;
        grid-row: span 2;
        cursor: pointer;
      }

      .main-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .thumbnail {
        position: relative;
        cursor: pointer;
        overflow: hidden;
      }

      .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.3s;
      }

      .thumbnail:hover img {
        transform: scale(1.05);
      }

      .photo-overlay {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .property-details {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
      }

      .details-section {
        background: var(--white);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid var(--line);
      }

      .details-section h2 {
        margin: 0 0 1rem;
        font-size: 1.4rem;
      }

      .details-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .detail-item {
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
      }

      .detail-label {
        font-size: 0.85rem;
        color: var(--muted);
        margin-bottom: 0.3rem;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.05em;
      }

      .detail-value {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--ink);
      }

      .features-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }

      .features-list li {
        padding: 0.6rem 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        font-weight: 500;
      }

      .features-list li::before {
        content: "‚úì ";
        color: var(--sale);
        font-weight: 700;
        margin-right: 0.5rem;
      }

      .price-card {
        background: var(--white);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid var(--line);
        position: sticky;
        top: 6rem;
      }

      .price-amount {
        font-size: 2rem;
        font-weight: 700;
        color: var(--brand);
        margin: 0 0 0.5rem;
      }

      .price-type {
        color: var(--muted);
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
      }

      .contact-btn {
        display: block;
        width: 100%;
        padding: 1rem;
        background: var(--brand);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        transition: background 0.2s;
      }

      .contact-btn:hover {
        background: var(--brand-soft);
      }

      .brochure-link {
        display: block;
        width: 100%;
        padding: 1rem;
        background: var(--bg);
        color: var(--brand);
        border: 1px solid var(--line);
        border-radius: 0.5rem;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        margin-top: 1rem;
        transition: all 0.2s;
      }

      .brochure-link:hover {
        background: var(--brand);
        color: white;
        border-color: var(--brand);
      }

      /* Modal for full-size photos */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        max-width: 90vw;
        max-height: 90vh;
        position: relative;
      }

      .modal-content img {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
      }

      .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        color: white;
        font-size: 2rem;
        font-weight: 700;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.5);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
      }

      .modal-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        font-size: 2rem;
        padding: 1rem;
        cursor: pointer;
        border-radius: 0.5rem;
        user-select: none;
      }

      .modal-prev {
        left: 1rem;
      }

      .modal-next {
        right: 1rem;
      }

      .modal-counter {
        position: absolute;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        font-weight: 600;
      }

      .loading-indicator {
        text-align: center;
        padding: 3rem;
        color: var(--muted);
      }

      .data-source-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: 1rem;
      }

      .data-source-api {
        background: #e0f2fe;
        color: #0369a1;
      }

      .data-source-local {
        background: #fef3c7;
        color: #92400e;
      }

      @media (max-width: 960px) {
        .photo-gallery {
          grid-template-columns: 1fr;
        }

        .main-photo {
          grid-row: span 1;
          height: 300px;
        }

        .thumbnail {
          height: 150px;
        }

        .property-details {
          grid-template-columns: 1fr;
        }

        .details-grid {
          grid-template-columns: 1fr;
        }

        .features-list {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Mobile Drawer Menu -->
    <div id="drawer-overlay" class="drawer-overlay"></div>
    <aside id="mobile-drawer" class="mobile-drawer" aria-hidden="true">
      <div class="drawer-header">
        <span class="drawer-brand">Henri Martin Immobilier</span>
        <button id="drawer-close" class="drawer-close" aria-label="Fermer le menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="drawer-search">
        <input type="search" placeholder="Rechercher sur le site..." aria-label="Rechercher sur le site" />
      </div>

      <nav class="drawer-nav">
        <div class="drawer-section">
          <button class="drawer-section-btn" aria-expanded="false" aria-controls="drawer-locations">
            <span>Locations</span>
            <svg class="drawer-chevron" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div id="drawer-locations" class="drawer-section-content">
            <a href="index.html#biens">Biens √† louer</a>
            <a href="services/estimation.html">Estimation locative</a>
            <a href="services/mise-en-location.html">Mise en location</a>
          </div>
        </div>

        <div class="drawer-section">
          <button class="drawer-section-btn" aria-expanded="false" aria-controls="drawer-ventes">
            <span>Ventes</span>
            <svg class="drawer-chevron" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div id="drawer-ventes" class="drawer-section-content">
            <a href="index.html#biens">Biens √† vendre</a>
            <a href="services/estimation.html">Estimation vente</a>
            <a href="ventes/off-market.html">Vendre en off-market</a>
          </div>
        </div>

        <div class="drawer-section">
          <button class="drawer-section-btn" aria-expanded="false" aria-controls="drawer-proprietaires">
            <span>Propri√©taires</span>
            <svg class="drawer-chevron" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div id="drawer-proprietaires" class="drawer-section-content">
            <a href="services/estimation.html">Estimation gratuite</a>
            <a href="services/rentabilite.html">Calcul de rentabilit√©</a>
            <a href="services/mise-en-location.html">Mise en location</a>
            <a href="services/modes-location.html">Modes de location</a>
          </div>
        </div>

        <div class="drawer-section">
          <button class="drawer-section-btn" aria-expanded="false" aria-controls="drawer-agence">
            <span>L'agence</span>
            <svg class="drawer-chevron" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div id="drawer-agence" class="drawer-section-content">
            <a href="agence/histoire.html">Histoire</a>
            <a href="agence/equipe.html">√âquipe</a>
            <a href="agence/temoignages.html">T√©moignages</a>
            <a href="agence/partenaires.html">Partenaires</a>
          </div>
        </div>

        <div class="drawer-section drawer-section-simple">
          <a href="blog.html" class="drawer-link">Blog</a>
        </div>
      </nav>

      <div class="drawer-footer">
        <a href="login.html" class="drawer-btn drawer-btn-primary">Se connecter</a>
        <a href="index.html#contact" class="drawer-btn drawer-btn-secondary">Contact</a>
      </div>
    </aside>

    <header class="detail-header">
      <div class="container detail-nav">
        <button id="burger-menu" class="burger-menu" aria-label="Ouvrir le menu" aria-expanded="false">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <a href="index.html" class="back-btn">
          <span>‚Üê</span>
          <span>Retour aux biens</span>
        </a>
        <a href="#top" class="brand">Henri Martin Immobilier<span id="data-source-badge"></span></a>
      </div>
    </header>

    <main class="container detail-container">
      <div id="loading-indicator" class="loading-indicator">
        <p>‚è≥ Chargement du bien...</p>
      </div>

      <div id="property-content" style="display: none;">
        <div class="property-header">
          <div class="property-badge-row">
            <span class="badge" id="property-badge"></span>
            <span class="ref" id="property-ref"></span>
          </div>
          <h1 class="property-title" id="property-title"></h1>
          <p class="property-location" id="property-location"></p>
        </div>

        <div class="photo-gallery" id="photo-gallery">
          <!-- Photos will be inserted here -->
        </div>

        <div class="property-details">
          <div>
            <div class="details-section">
              <h2>Caract√©ristiques</h2>
              <div class="details-grid" id="details-grid">
                <!-- Details will be inserted here -->
              </div>
            </div>

            <div class="details-section" style="margin-top: 1rem;">
              <h2>√âquipements</h2>
              <ul class="features-list" id="features-list">
                <!-- Features will be inserted here -->
              </ul>
            </div>
          </div>

          <div>
            <div class="price-card">
              <div class="price-amount" id="property-price"></div>
              <div class="price-type" id="price-type"></div>
              <a href="#contact" class="contact-btn">Contacter</a>
              <a href="#" id="brochure-link" class="brochure-link" target="_blank" rel="noopener noreferrer">
                Dossier complet Canva ‚Üí
              </a>
              <div class="cloudinary-ref-section" style="display: none; margin-top: 12px; padding: 8px 12px; background: #f0f9ff; border-radius: 6px; font-size: 13px; color: #1e40af;">
                üìÅ Dossier Cloudinary: <code id="cloudinary-folder-info" style="font-family: monospace; background: white; padding: 2px 6px; border-radius: 3px; font-weight: 600;"></code>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Photo Modal -->
    <div class="modal" id="photo-modal">
      <span class="modal-close" id="modal-close">&times;</span>
      <span class="modal-nav modal-prev" id="modal-prev">‚Äπ</span>
      <span class="modal-nav modal-next" id="modal-next">‚Ä∫</span>
      <div class="modal-content">
        <img id="modal-image" src="" alt="">
      </div>
      <div class="modal-counter" id="modal-counter"></div>
    </div>

    <footer>
      <p>¬© 2026 Henri Martin Immobilier ‚Äî Plateforme partenaire immobili√®re</p>
    </footer>

    <script src="config.js"></script>
    <script src="api.js"></script>
    <script>
      // Get property ID from URL (supporting both 'id' and 'ref' for compatibility)
      const urlParams = new URLSearchParams(window.location.search);
      const propertyId = urlParams.get('id') || urlParams.get('ref');

      let currentProperty = null;
      let currentPhotoIndex = 0;
      let photos = [];
      let dataSource = 'unknown'; // Track where data came from: 'api', 'local', or 'unknown'

      /**
       * Try to load property data from GitHub API (Mode B)
       * Returns null if API fails or is not available
       */
      async function loadFromAPI() {
        try {
          console.log('Attempting to load from GitHub API...');
          
          // Use the PropertyAPI class from api.js
          if (!window.propertyAPI) {
            console.log('PropertyAPI not available, skipping API mode');
            return null;
          }

          const result = await window.propertyAPI.fetchProperties();
          
          if (result && result.data && result.data.properties) {
            console.log('Successfully loaded from GitHub API');
            dataSource = 'api';
            return result.data;
          }
          
          return null;
        } catch (error) {
          console.log('API loading failed, will fallback to local JSON:', error.message);
          return null;
        }
      }

      /**
       * Load property data from local JSON file (Fallback mode)
       */
      async function loadFromLocal() {
        try {
          console.log('Loading from local biens.json...');
          
          const response = await fetch('biens.json', {
            cache: 'no-cache',
            headers: {
              'Accept': 'application/json'
            }
          });
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const contentType = response.headers.get('content-type');
          if (contentType && !contentType.includes('application/json')) {
            throw new Error(`Invalid content type: ${contentType}`);
          }

          const data = await response.json();
          
          if (!data || !data.properties || !Array.isArray(data.properties)) {
            throw new Error('Invalid data structure in biens.json');
          }

          console.log('Successfully loaded from local JSON');
          dataSource = 'local';
          return data;
        } catch (error) {
          console.error('Failed to load from local JSON:', error);
          throw error;
        }
      }

      /**
       * Main function to load property details with fallback strategy
       */
      async function loadPropertyDetails() {
        try {
          // Try API first (Mode B), then fallback to local JSON
          let data = await loadFromAPI();
          
          if (!data) {
            console.log('Falling back to local JSON...');
            data = await loadFromLocal();
          }

          // Update UI badge to show data source
          updateDataSourceBadge();

          // Find the property by ID (or reference)
          currentProperty = data.properties.find(p => 
            p.reference === propertyId || 
            p.id === propertyId ||
            String(p.reference) === String(propertyId)
          );

          if (!currentProperty) {
            showError(
              'Bien non trouv√©',
              `Aucun bien trouv√© avec l'identifiant: ${propertyId || 'non sp√©cifi√©'}`,
              [
                'V√©rifiez que l\'identifiant est correct',
                'Retournez √† la liste des biens'
              ]
            );
            return;
          }

          displayProperty(currentProperty);
        } catch (error) {
          console.error('Error loading property:', error);
          showError(
            'Erreur de chargement',
            error.message,
            [
              'V√©rifiez votre connexion internet',
              'Rechargez la page (F5)',
              'V√©rifiez que le fichier biens.json existe'
            ]
          );
        }
      }

      /**
       * Update the data source badge in the header
       */
      function updateDataSourceBadge() {
        const badge = document.getElementById('data-source-badge');
        if (!badge) return;

        if (dataSource === 'api') {
          badge.className = 'data-source-badge data-source-api';
          badge.textContent = 'Mode API';
          badge.title = 'Donn√©es charg√©es depuis l\'API GitHub';
        } else if (dataSource === 'local') {
          badge.className = 'data-source-badge data-source-local';
          badge.textContent = 'Mode Local';
          badge.title = 'Donn√©es charg√©es depuis le fichier local';
        }
      }

      /**
       * Display error message to user
       */
      function showError(title, message, suggestions = []) {
        const container = document.querySelector('.detail-container');
        const loading = document.getElementById('loading-indicator');
        const content = document.getElementById('property-content');
        
        loading.style.display = 'none';
        content.style.display = 'none';

        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = 'text-align: center; padding: 3rem; background: #fff5f5; border: 1px solid #fc8181; border-radius: 8px; margin: 2rem 0;';
        
        const h2 = document.createElement('h2');
        h2.style.cssText = 'color: #e53e3e; margin-bottom: 1rem;';
        h2.textContent = `‚ùå ${title}`;
        
        const p = document.createElement('p');
        p.style.cssText = 'color: #c53030; margin-bottom: 1rem;';
        p.textContent = message;
        
        errorDiv.appendChild(h2);
        errorDiv.appendChild(p);

        if (suggestions.length > 0) {
          const suggestionsDiv = document.createElement('div');
          suggestionsDiv.style.cssText = 'text-align: left; max-width: 500px; margin: 1rem auto; background: white; padding: 1rem; border-radius: 4px;';
          
          const strong = document.createElement('strong');
          strong.textContent = 'üí° Actions √† essayer:';
          suggestionsDiv.appendChild(strong);
          
          const ul = document.createElement('ul');
          ul.style.cssText = 'color: #4a5568; margin-left: 1.5rem; margin-top: 0.5rem;';
          suggestions.forEach(suggestion => {
            const li = document.createElement('li');
            li.textContent = suggestion;
            ul.appendChild(li);
          });
          
          suggestionsDiv.appendChild(ul);
          errorDiv.appendChild(suggestionsDiv);
        }

        const returnP = document.createElement('p');
        returnP.style.marginTop = '1rem';
        const returnLink = document.createElement('a');
        returnLink.href = 'index.html';
        returnLink.style.cssText = 'color: #007bff; text-decoration: underline;';
        returnLink.textContent = '‚Üê Retour √† l\'accueil';
        returnP.appendChild(returnLink);
        errorDiv.appendChild(returnP);

        container.innerHTML = '';
        container.appendChild(errorDiv);
      }

      /**
       * Display property information on the page
       */
      function displayProperty(property) {
        // Hide loading, show content
        document.getElementById('loading-indicator').style.display = 'none';
        document.getElementById('property-content').style.display = 'block';

        // Set title and location
        document.getElementById('property-title').textContent = property.title;
        document.getElementById('property-location').textContent = 
          `${property.city} ${property.district}`;

        // Set badge
        const badge = document.getElementById('property-badge');
        badge.textContent = property.transaction === 'vente' ? 'Vente' : 'Location';
        badge.classList.add(property.transaction === 'vente' ? 'sale' : 'rent');

        // Set reference
        document.getElementById('property-ref').textContent = `R√©f. ${property.reference}`;

        // Set price
        const priceElement = document.getElementById('property-price');
        const priceTypeElement = document.getElementById('price-type');
        if (property.transaction === 'location') {
          priceElement.textContent = `${property.price.toLocaleString('fr-FR')} ‚Ç¨`;
          priceTypeElement.textContent = 'par mois';
        } else {
          priceElement.textContent = `${property.price.toLocaleString('fr-FR')} ‚Ç¨`;
          priceTypeElement.textContent = '';
        }

        // Display photos - ensure we have valid images
        if (property.images && Array.isArray(property.images) && property.images.length > 0) {
          photos = property.images;
        } else if (property.image) {
          photos = [property.image];
        } else {
          photos = [];
        }
        displayPhotoGallery(photos);

        // Display details
        const detailsGrid = document.getElementById('details-grid');
        detailsGrid.innerHTML = `
          <div class="detail-item">
            <div class="detail-label">Surface</div>
            <div class="detail-value">${property.surface} m¬≤</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Pi√®ces</div>
            <div class="detail-value">${property.rooms}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Type</div>
            <div class="detail-value">${property.propertyType}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Transaction</div>
            <div class="detail-value">${property.transaction === 'vente' ? 'Vente' : 'Location'}</div>
          </div>
        `;

        // Display features
        const featuresList = document.getElementById('features-list');
        featuresList.innerHTML = property.features.map(feature => 
          `<li>${feature}</li>`
        ).join('');

        // Set brochure link
        const brochureLink = document.getElementById('brochure-link');
        if (property.brochureUrl && property.brochureUrl !== null && property.brochureUrl !== '' && property.brochureUrl !== 'null') {
          brochureLink.href = property.brochureUrl;
        } else {
          brochureLink.style.display = 'none';
        }

        // Display cloudinaryFolder reference if available
        const cloudinaryFolderInfo = document.getElementById('cloudinary-folder-info');
        if (cloudinaryFolderInfo && property.cloudinaryFolder) {
          cloudinaryFolderInfo.textContent = property.cloudinaryFolder;
          cloudinaryFolderInfo.style.display = 'inline';
          const cloudinarySection = cloudinaryFolderInfo.closest('.cloudinary-ref-section');
          if (cloudinarySection) {
            cloudinarySection.style.display = 'block';
          }
        }
      }

      /**
       * Display photo gallery with main image and thumbnails
       */
      function displayPhotoGallery(photos) {
        const gallery = document.getElementById('photo-gallery');
        gallery.innerHTML = '';

        if (photos.length === 0) return;

        // Main photo
        const mainPhoto = document.createElement('div');
        mainPhoto.className = 'main-photo';
        mainPhoto.innerHTML = `
          <img src="${photos[0]}" alt="${currentProperty.alt || 'Photo principale'}">
          ${photos.length > 1 ? `<div class="photo-overlay">${photos.length} photos</div>` : ''}
        `;
        mainPhoto.addEventListener('click', () => openModal(0));
        gallery.appendChild(mainPhoto);

        // Thumbnails (show up to 4 more)
        const thumbnailsToShow = Math.min(photos.length - 1, 4);
        for (let i = 1; i <= thumbnailsToShow; i++) {
          const thumbnail = document.createElement('div');
          thumbnail.className = 'thumbnail';
          thumbnail.style.height = '250px';
          thumbnail.innerHTML = `<img src="${photos[i]}" alt="Photo ${i + 1}">`;
          thumbnail.addEventListener('click', () => openModal(i));
          gallery.appendChild(thumbnail);
        }

        // If more than 5 photos, show "+X more" overlay on last thumbnail
        if (photos.length > 5) {
          const lastThumbnail = gallery.querySelector('.thumbnail:last-child');
          if (lastThumbnail) {
            const overlay = document.createElement('div');
            overlay.className = 'photo-overlay';
            overlay.textContent = `+${photos.length - 5} photos`;
            overlay.style.top = '50%';
            overlay.style.left = '50%';
            overlay.style.transform = 'translate(-50%, -50%)';
            overlay.style.bottom = 'auto';
            overlay.style.right = 'auto';
            lastThumbnail.style.position = 'relative';
            lastThumbnail.appendChild(overlay);
          }
        }
      }

      // Modal functionality
      function openModal(index) {
        currentPhotoIndex = index;
        showModalPhoto();
        document.getElementById('photo-modal').classList.add('active');
      }

      function closeModal() {
        document.getElementById('photo-modal').classList.remove('active');
      }

      function showModalPhoto() {
        const img = document.getElementById('modal-image');
        const counter = document.getElementById('modal-counter');

        img.src = photos[currentPhotoIndex];
        counter.textContent = `${currentPhotoIndex + 1} / ${photos.length}`;

        // Show/hide navigation buttons
        document.getElementById('modal-prev').style.display = 
          currentPhotoIndex > 0 ? 'block' : 'none';
        document.getElementById('modal-next').style.display = 
          currentPhotoIndex < photos.length - 1 ? 'block' : 'none';
      }

      function nextPhoto() {
        if (currentPhotoIndex < photos.length - 1) {
          currentPhotoIndex++;
          showModalPhoto();
        }
      }

      function prevPhoto() {
        if (currentPhotoIndex > 0) {
          currentPhotoIndex--;
          showModalPhoto();
        }
      }

      // Event listeners
      document.getElementById('modal-close').addEventListener('click', closeModal);
      document.getElementById('modal-next').addEventListener('click', nextPhoto);
      document.getElementById('modal-prev').addEventListener('click', prevPhoto);

      // Close modal on outside click
      document.getElementById('photo-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeModal();
        }
      });

      // Keyboard navigation
      document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('photo-modal');
        if (modal.classList.contains('active')) {
          if (e.key === 'Escape') closeModal();
          if (e.key === 'ArrowLeft') prevPhoto();
          if (e.key === 'ArrowRight') nextPhoto();
        }
      });

      // Load property on page load
      loadPropertyDetails();
    </script>
    <script src="drawer.js"></script>
  </body>
</html>
