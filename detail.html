<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Détail du bien - Henri Martin Immobilier</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .detail-header {
        background: var(--white);
        border-bottom: 1px solid var(--line);
        padding: 1.2rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .detail-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        color: var(--brand);
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        border: 1px solid var(--line);
        transition: all 0.2s;
      }

      .back-btn:hover {
        background: var(--bg);
        border-color: var(--brand);
      }

      .detail-container {
        padding: 2rem 0;
      }

      .property-header {
        margin-bottom: 2rem;
      }

      .property-badge-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .property-title {
        font-size: 2rem;
        margin: 0 0 0.5rem;
        font-weight: 700;
      }

      .property-location {
        color: var(--muted);
        font-size: 1.1rem;
        margin: 0;
      }

      .photo-gallery {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 0.5rem;
        margin-bottom: 2rem;
        border-radius: 1rem;
        overflow: hidden;
      }

      .main-photo {
        position: relative;
        grid-row: span 2;
        cursor: pointer;
      }

      .main-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .thumbnail {
        position: relative;
        cursor: pointer;
        overflow: hidden;
      }

      .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.3s;
      }

      .thumbnail:hover img {
        transform: scale(1.05);
      }

      .photo-overlay {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .property-details {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
      }

      .details-section {
        background: var(--white);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid var(--line);
      }

      .details-section h2 {
        margin: 0 0 1rem;
        font-size: 1.4rem;
      }

      .details-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .detail-item {
        padding: 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
      }

      .detail-label {
        font-size: 0.85rem;
        color: var(--muted);
        margin-bottom: 0.3rem;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.05em;
      }

      .detail-value {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--ink);
      }

      .features-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }

      .features-list li {
        padding: 0.6rem 1rem;
        background: var(--bg);
        border-radius: 0.5rem;
        font-weight: 500;
      }

      .features-list li::before {
        content: "✓ ";
        color: var(--sale);
        font-weight: 700;
        margin-right: 0.5rem;
      }

      .price-card {
        background: var(--white);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid var(--line);
        position: sticky;
        top: 6rem;
      }

      .price-amount {
        font-size: 2rem;
        font-weight: 700;
        color: var(--brand);
        margin: 0 0 0.5rem;
      }

      .price-type {
        color: var(--muted);
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
      }

      .contact-btn {
        display: block;
        width: 100%;
        padding: 1rem;
        background: var(--brand);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        transition: background 0.2s;
      }

      .contact-btn:hover {
        background: var(--brand-soft);
      }

      .brochure-link {
        display: block;
        width: 100%;
        padding: 1rem;
        background: var(--bg);
        color: var(--brand);
        border: 1px solid var(--line);
        border-radius: 0.5rem;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        margin-top: 1rem;
        transition: all 0.2s;
      }

      .brochure-link:hover {
        background: var(--brand);
        color: white;
        border-color: var(--brand);
      }

      /* Modal for full-size photos */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        max-width: 90vw;
        max-height: 90vh;
        position: relative;
      }

      .modal-content img {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
      }

      .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        color: white;
        font-size: 2rem;
        font-weight: 700;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.5);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
      }

      .modal-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        font-size: 2rem;
        padding: 1rem;
        cursor: pointer;
        border-radius: 0.5rem;
        user-select: none;
      }

      .modal-prev {
        left: 1rem;
      }

      .modal-next {
        right: 1rem;
      }

      .modal-counter {
        position: absolute;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        font-weight: 600;
      }

      @media (max-width: 960px) {
        .photo-gallery {
          grid-template-columns: 1fr;
        }

        .main-photo {
          grid-row: span 1;
          height: 300px;
        }

        .thumbnail {
          height: 150px;
        }

        .property-details {
          grid-template-columns: 1fr;
        }

        .details-grid {
          grid-template-columns: 1fr;
        }

        .features-list {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="detail-header">
      <div class="container detail-nav">
        <a href="index.html" class="back-btn">
          <span>←</span>
          <span>Retour aux biens</span>
        </a>
        <a href="#top" class="brand">Henri Martin Immobilier</a>
      </div>
    </header>

    <main class="container detail-container">
      <div class="property-header">
        <div class="property-badge-row">
          <span class="badge" id="property-badge"></span>
          <span class="ref" id="property-ref"></span>
        </div>
        <h1 class="property-title" id="property-title"></h1>
        <p class="property-location" id="property-location"></p>
      </div>

      <div class="photo-gallery" id="photo-gallery">
        <!-- Photos will be inserted here -->
      </div>

      <div class="property-details">
        <div>
          <div class="details-section">
            <h2>Caractéristiques</h2>
            <div class="details-grid" id="details-grid">
              <!-- Details will be inserted here -->
            </div>
          </div>

          <div class="details-section" style="margin-top: 1rem;">
            <h2>Équipements</h2>
            <ul class="features-list" id="features-list">
              <!-- Features will be inserted here -->
            </ul>
          </div>
        </div>

        <div>
          <div class="price-card">
            <div class="price-amount" id="property-price"></div>
            <div class="price-type" id="price-type"></div>
            <a href="#contact" class="contact-btn">Contacter</a>
            <a href="#" id="brochure-link" class="brochure-link" target="_blank" rel="noopener noreferrer">
              Dossier complet Canva →
            </a>
          </div>
        </div>
      </div>
    </main>

    <!-- Photo Modal -->
    <div class="modal" id="photo-modal">
      <span class="modal-close" id="modal-close">&times;</span>
      <span class="modal-nav modal-prev" id="modal-prev">‹</span>
      <span class="modal-nav modal-next" id="modal-next">›</span>
      <div class="modal-content">
        <img id="modal-image" src="" alt="">
      </div>
      <div class="modal-counter" id="modal-counter"></div>
    </div>

    <footer>
      <p>© 2026 Henri Martin Immobilier — Plateforme partenaire immobilière</p>
    </footer>

    <script>
      // Get property reference from URL
      const urlParams = new URLSearchParams(window.location.search);
      const propertyRef = urlParams.get('ref');

      let currentProperty = null;
      let currentPhotoIndex = 0;
      let photos = [];

      // Load property data
      async function loadPropertyDetails() {
        try {
          const response = await fetch('biens.json');
          if (!response.ok) {
            throw new Error('Failed to load properties');
          }

          const data = await response.json();
          currentProperty = data.properties.find(p => p.reference === propertyRef);

          if (!currentProperty) {
            document.querySelector('.detail-container').innerHTML = 
              '<p style="text-align: center; padding: 3rem;">Bien non trouvé</p>';
            return;
          }

          displayProperty(currentProperty);
        } catch (error) {
          console.error('Error loading property:', error);
          document.querySelector('.detail-container').innerHTML = 
            '<p style="text-align: center; padding: 3rem;">Erreur de chargement</p>';
        }
      }

      function displayProperty(property) {
        // Set title and location
        document.getElementById('property-title').textContent = property.title;
        document.getElementById('property-location').textContent = 
          `${property.city} ${property.district}`;

        // Set badge
        const badge = document.getElementById('property-badge');
        badge.textContent = property.transaction === 'vente' ? 'Vente' : 'Location';
        badge.classList.add(property.transaction === 'vente' ? 'sale' : 'rent');

        // Set reference
        document.getElementById('property-ref').textContent = `Réf. ${property.reference}`;

        // Set price
        const priceElement = document.getElementById('property-price');
        const priceTypeElement = document.getElementById('price-type');
        if (property.transaction === 'location') {
          priceElement.textContent = `${property.price.toLocaleString('fr-FR')} €`;
          priceTypeElement.textContent = 'par mois';
        } else {
          priceElement.textContent = `${property.price.toLocaleString('fr-FR')} €`;
          priceTypeElement.textContent = '';
        }

        // Display photos
        // Check if property has images array, otherwise use single image
        photos = property.images || [property.image];
        displayPhotoGallery(photos);

        // Display details
        const detailsGrid = document.getElementById('details-grid');
        detailsGrid.innerHTML = `
          <div class="detail-item">
            <div class="detail-label">Surface</div>
            <div class="detail-value">${property.surface} m²</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Pièces</div>
            <div class="detail-value">${property.rooms}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Type</div>
            <div class="detail-value">${property.propertyType}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Transaction</div>
            <div class="detail-value">${property.transaction === 'vente' ? 'Vente' : 'Location'}</div>
          </div>
        `;

        // Display features
        const featuresList = document.getElementById('features-list');
        featuresList.innerHTML = property.features.map(feature => 
          `<li>${feature}</li>`
        ).join('');

        // Set brochure link
        const brochureLink = document.getElementById('brochure-link');
        if (property.brochureUrl && property.brochureUrl !== 'null') {
          brochureLink.href = property.brochureUrl;
        } else {
          brochureLink.style.display = 'none';
        }
      }

      function displayPhotoGallery(photos) {
        const gallery = document.getElementById('photo-gallery');
        gallery.innerHTML = '';

        if (photos.length === 0) return;

        // Main photo
        const mainPhoto = document.createElement('div');
        mainPhoto.className = 'main-photo';
        mainPhoto.innerHTML = `
          <img src="${photos[0]}" alt="${currentProperty.alt || 'Photo principale'}">
          ${photos.length > 1 ? `<div class="photo-overlay">${photos.length} photos</div>` : ''}
        `;
        mainPhoto.addEventListener('click', () => openModal(0));
        gallery.appendChild(mainPhoto);

        // Thumbnails (show up to 4 more)
        const thumbnailsToShow = Math.min(photos.length - 1, 4);
        for (let i = 1; i <= thumbnailsToShow; i++) {
          const thumbnail = document.createElement('div');
          thumbnail.className = 'thumbnail';
          thumbnail.style.height = '250px';
          thumbnail.innerHTML = `<img src="${photos[i]}" alt="Photo ${i + 1}">`;
          thumbnail.addEventListener('click', () => openModal(i));
          gallery.appendChild(thumbnail);
        }

        // If more than 5 photos, show "+X more" overlay on last thumbnail
        if (photos.length > 5) {
          const lastThumbnail = gallery.querySelector('.thumbnail:last-child');
          if (lastThumbnail) {
            const overlay = document.createElement('div');
            overlay.className = 'photo-overlay';
            overlay.textContent = `+${photos.length - 5} photos`;
            overlay.style.top = '50%';
            overlay.style.left = '50%';
            overlay.style.transform = 'translate(-50%, -50%)';
            overlay.style.bottom = 'auto';
            overlay.style.right = 'auto';
            lastThumbnail.style.position = 'relative';
            lastThumbnail.appendChild(overlay);
          }
        }
      }

      // Modal functionality
      function openModal(index) {
        currentPhotoIndex = index;
        showModalPhoto();
        document.getElementById('photo-modal').classList.add('active');
      }

      function closeModal() {
        document.getElementById('photo-modal').classList.remove('active');
      }

      function showModalPhoto() {
        const modal = document.getElementById('photo-modal');
        const img = document.getElementById('modal-image');
        const counter = document.getElementById('modal-counter');

        img.src = photos[currentPhotoIndex];
        counter.textContent = `${currentPhotoIndex + 1} / ${photos.length}`;

        // Show/hide navigation buttons
        document.getElementById('modal-prev').style.display = 
          currentPhotoIndex > 0 ? 'block' : 'none';
        document.getElementById('modal-next').style.display = 
          currentPhotoIndex < photos.length - 1 ? 'block' : 'none';
      }

      function nextPhoto() {
        if (currentPhotoIndex < photos.length - 1) {
          currentPhotoIndex++;
          showModalPhoto();
        }
      }

      function prevPhoto() {
        if (currentPhotoIndex > 0) {
          currentPhotoIndex--;
          showModalPhoto();
        }
      }

      // Event listeners
      document.getElementById('modal-close').addEventListener('click', closeModal);
      document.getElementById('modal-next').addEventListener('click', nextPhoto);
      document.getElementById('modal-prev').addEventListener('click', prevPhoto);

      // Close modal on outside click
      document.getElementById('photo-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeModal();
        }
      });

      // Keyboard navigation
      document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('photo-modal');
        if (modal.classList.contains('active')) {
          if (e.key === 'Escape') closeModal();
          if (e.key === 'ArrowLeft') prevPhoto();
          if (e.key === 'ArrowRight') nextPhoto();
        }
      });

      // Load property on page load
      loadPropertyDetails();
    </script>
  </body>
</html>
